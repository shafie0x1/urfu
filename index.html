<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ü–µ—Å—Å –∑–∞—Å–µ–ª–µ–Ω–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            direction: ltr;
            text-align: left;
        }
        h1 {
            font-size: 24px;
            color: #0088cc;
            text-align: center;
        }
        h3 {
            font-size: 18px;
            color: #555;
            margin-top: 20px;
        }
        .checklist {
            max-width: 600px;
            margin: 0 auto;
            display: none;
        }
        .item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .item input[type="checkbox"] {
            margin-right: 10px;
        }
        .item label {
            flex: 1;
            font-size: 16px;
        }
        .completed {
            text-decoration: line-through;
            color: #888;
        }
        .input-section {
            text-align: center;
            margin-bottom: 20px;
        }
        .input-section input, .input-section select {
            padding: 8px;
            font-size: 16px;
            width: 80%;
            max-width: 300px;
            margin: 5px auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: block;
        }
        #newStudentInput {
            display: none; /* ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ≠ŸÇŸÑ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿß */
        }
        .input-section button {
            padding: 10px 20px;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .input-section button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä–æ—Ü–µ—Å—Å –∑–∞—Å–µ–ª–µ–Ω–∏—è –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h1>
    <div class="input-section" id="inputSection">
        <input type="text" id="guideName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è" required>
        <select id="studentName" required>
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
            <option value="new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞</option>
        </select>
        <input type="text" id="newStudentInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞">
        <input type="text" id="tripNumber" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ä–µ–π—Å–∞" required>
        <button id="startChecklist" disabled>–ù–∞—á–∞—Ç—å</button>
    </div>
    <div class="checklist" id="checklist">
        <h3>üöÄ –ü–µ—Ä–µ–¥ –ø—Ä–∏–µ–∑–¥–æ–º</h3>
        <div class="item"><input type="checkbox" id="task1"><label for="task1">–ó–∞–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –ø—Ä–∏–µ–∑–¥</label></div>
        <div class="item"><input type="checkbox" id="task2"><label for="task2">–ü–∏—à–µ–º –ø–∏—Å—å–º–æ —Å—Ç—É–¥–µ–Ω—Ç—É</label></div>
        <div class="item"><input type="checkbox" id="task3"><label for="task3">–ó–∞–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–∫—Å–∏ –∏ –µ–¥–µ–º –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç</label></div>

        <h3>‚úàÔ∏è –í—Å—Ç—Ä–µ—á–∞ –∏ –ø–µ—Ä–≤–æ–µ –∑–∞—Å–µ–ª–µ–Ω–∏–µ</h3>
        <div class="item"><input type="checkbox" id="task4"><label for="task4">–í—Å—Ç—Ä–µ—á–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É</label></div>
        <div class="item"><input type="checkbox" id="task5"><label for="task5">–ó–∞—Å–µ–ª—è–µ–º—Å—è –≤ —Ö–æ—Å—Ç–µ–ª</label></div>

        <h3>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
        <div class="item"><input type="checkbox" id="task6"><label for="task6">–û–±–º–µ–Ω–∏–≤–∞–µ–º –¥–µ–Ω—å–≥–∏</label></div>
        <div class="item"><input type="checkbox" id="task7"><label for="task7">–ü–æ–∫—É–ø–∞–µ–º –ø–æ–ª–∏—Å –î–ú–°</label></div>
        <div class="item"><input type="checkbox" id="task8"><label for="task8">–î–µ–ª–∞–µ–º –∫–æ–ø–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</label></div>
        <div class="item"><input type="checkbox" id="task9"><label for="task9">–ü—Ä–æ—Ö–æ–¥–∏–º –º–µ–¥–æ—Å–º–æ—Ç—Ä –≤ –º–µ–¥—Å–∞–Ω—á–∞—Å—Ç–∏</label></div>

        <h3>üéì –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤ –£—Ä–§–£</h3>
        <div class="item"><input type="checkbox" id="task10"><label for="task10">–ó–∞—á–∏—Å–ª—è–µ–º—Å—è –≤ –£—Ä–§–£</label></div>
        <div class="item"><input type="checkbox" id="task11"><label for="task11">–ü–æ–ª—É—á–∞–µ–º –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ –æ–±—â–µ–∂–∏—Ç–∏–µ</label></div>
        <div class="item"><input type="checkbox" id="task12"><label for="task12">–û—Ñ–æ—Ä–º–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</label></div>
        <div class="item"><input type="checkbox" id="task13"><label for="task13">–ó–∞—Å–µ–ª—è–µ–º—Å—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–µ</label></div>

        <h3>üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ–ø—É—Å–∫</h3>
        <div class="item"><input type="checkbox" id="task14"><label for="task14">–û—Ñ–æ—Ä–º–ª—è–µ–º —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫</label></div>
        <div class="item"><input type="checkbox" id="task15"><label for="task15">–î–µ–ª–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ –ø–∞—Å–ø–æ—Ä—Ç–∞</label></div>
        <div class="item"><input type="checkbox" id="task16"><label for="task16">–û—Ñ–æ—Ä–º–ª—è–µ–º –°–ù–ò–õ–°</label></div>
        <div class="item"><input type="checkbox" id="task17"><label for="task17">–î–µ–ª–∞–µ–º –±–∏–æ–º–µ—Ç—Ä–∏—é</label></div>

        <h3>üì∂ –°–≤—è–∑—å –∏ –≥–æ—Å—É—Å–ª—É–≥–∏</h3>
        <div class="item"><input type="checkbox" id="task18"><label for="task18">–ü–æ–∫—É–ø–∞–µ–º —Å–∏–º-–∫–∞—Ä—Ç—É</label></div>
        <div class="item"><input type="checkbox" id="task19"><label for="task19">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –≥–æ—Å—É—Å–ª—É–≥–∏</label></div>
        <div class="item"><input type="checkbox" id="task20"><label for="task20">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Å–∏–º-–∫–∞—Ä—Ç—É –Ω–∞ –≥–æ—Å—É—Å–ª—É–≥–∞—Ö</label></div>

        <h3>üõÇ –í–∏–∑–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —à–∞–≥–∏</h3>
        <div class="item"><input type="checkbox" id="task21"><label for="task21">–ü—Ä–æ—Ö–æ–¥–∏–º –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞–Ω–∏–µ</label></div>
        <div class="item"><input type="checkbox" id="task22"><label for="task22">–ü—Ä–æ–¥–ª–µ–≤–∞–µ–º –≤–∏–∑—É</label></div>
        <div class="item"><input type="checkbox" id="task23"><label for="task23">–ü—Ä–æ—Ö–æ–¥–∏–º –¥–∞–∫—Ç–∏–ª–æ—Å–∫–æ–ø–∏—é</label></div>

        <h3>‚úÖ –ì–æ—Ç–æ–≤–æ!</h3>
        <div class="item"><label>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –£—Ä–§–£!</label></div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwx1vlDZjHJa3CQuT8ybUb_1qmNXzO8gdLelX1gi1nOqgtWvbNGFnfjeTorneeOAFaA/exec"; // ÿ±ÿßÿ®ÿ∑ ÿ≥ŸÉÿ±ÿ®ÿ™ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
        const UPDATE_URL = "https://script.google.com/macros/s/AKfycbxSFSTnE5deraKYru1jyYPukdXxPan5WixAmvRjBlBrvZu_5qGxL1nSQ0V6n7S7CJVl/exec"; // ÿ±ÿßÿ®ÿ∑ ÿ≥ŸÉÿ±ÿ®ÿ™ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        const guideInput = document.getElementById('guideName');
        const studentSelect = document.getElementById('studentName');
        const newStudentInput = document.getElementById('newStudentInput');
        const tripInput = document.getElementById('tripNumber');
        const startButton = document.getElementById('startChecklist');
        const checklist = document.getElementById('checklist');
        const inputSection = document.getElementById('inputSection');

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function checkInputs() {
            const studentValue = studentSelect.value === 'new' ? newStudentInput.value.trim() : studentSelect.value;
            startButton.disabled = !(guideInput.value.trim() && studentValue && tripInput.value.trim());
        }
        guideInput.addEventListener('input', () => {
            checkInputs();
            if (guideInput.value.trim()) fetchStudents(guideInput.value); // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿßÿ® ŸÖÿπ ŸÉŸÑ ÿ™ÿ∫ŸäŸäÿ±
        });
        studentSelect.addEventListener('change', () => {
            newStudentInput.style.display = studentSelect.value === 'new' ? 'block' : 'none';
            checkInputs();
        });
        newStudentInput.addEventListener('input', checkInputs);
        tripInput.addEventListener('input', checkInputs);

        // ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        window.onload = () => {
            const savedGuide = localStorage.getItem('lastGuide');
            if (savedGuide) {
                guideInput.value = savedGuide;
                fetchStudents(savedGuide);
            }
        };

        // ÿ¨ŸÑÿ® ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±ŸÅ
        function fetchStudents(guideName) {
            fetch(`${SCRIPT_URL}?guideName=${encodeURIComponent(guideName)}`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(students => {
                    studentSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞</option>';
                    students.forEach(student => {
                        const option = document.createElement('option');
                        option.value = student;
                        option.textContent = student;
                        studentSelect.appendChild(option);
                    });
                    const newOption = document.createElement('option');
                    newOption.value = 'new';
                    newOption.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞';
                    studentSelect.appendChild(newOption);
                })
                .catch(error => {
                    console.error('Error fetching students:', error);
                    studentSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞</option><option value="new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞</option>';
                });
        }

        // ÿ®ÿØÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        startButton.addEventListener('click', () => {
            localStorage.setItem('lastGuide', guideInput.value);
            inputSection.style.display = 'none';
            checklist.style.display = 'block';
            loadProgress();
        });

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑÿ≥ÿßÿ®ŸÇ
        function loadProgress() {
            const student = studentSelect.value === 'new' ? newStudentInput.value : studentSelect.value;
            const storageKey = `checklist_${student}`;
            const savedProgress = JSON.parse(localStorage.getItem(storageKey) || '{}');
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (savedProgress[checkbox.id]) {
                    checkbox.checked = true;
                    checkbox.nextElementSibling.classList.add('completed');
                }
            });
        }

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ Google Sheets ÿπÿ®ÿ± Apps Script
        function sendToGoogleSheets(student, trip, guide, task) {
            const data = {
                studentName: student,
                tripNumber: trip,
                guideName: guide,
                task: task,
                timestamp: new Date().toISOString()
            };
            fetch(UPDATE_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(error => console.error('Error sending data:', error));
        }

        // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.nextElementSibling;
                const student = studentSelect.value === 'new' ? newStudentInput.value : studentSelect.value;
                const trip = tripInput.value;
                const guide = guideInput.value;
                const storageKey = `checklist_${student}`;
                let progress = JSON.parse(localStorage.getItem(storageKey) || '{}');

                if (this.checked) {
                    label.classList.add('completed');
                    progress[this.id] = true;
                    sendToGoogleSheets(student, trip, guide, label.textContent);
                } else {
                    label.classList.remove('completed');
                    delete progress[this.id];
                }
                localStorage.setItem(storageKey, JSON.stringify(progress));
            });
        });
    </script>
</body>
</html>
